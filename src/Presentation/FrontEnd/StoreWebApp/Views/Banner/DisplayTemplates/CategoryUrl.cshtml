@using VirtoCommerce.Foundation.Catalogs.Search
@using VirtoCommerce.Web.Virto.Helpers
@{
    Layout = null;
    var currentModel = ViewData["Model"] as CategoryUrlModel;
}

@if (currentModel != null)
{
    var category = CatalogHelper.CatalogClient.GetCategory(currentModel.CategoryCode);
    if (string.IsNullOrEmpty(currentModel.CategoryCode) || category != null && category.IsActive)
    {
        @Html.Action("SearchResultsWithinCategory", "Search",
        new
        {
            cat = category !=null ? CatalogHelper.CreateCategoryModel(category):null,
            parameters = new SearchParameters { Sort = currentModel.SortField, PageSize = currentModel.ItemCount},
            name = "DisplayTemplates/SearchItems",
            criteria = currentModel.NewItemsOnly ? new CatalogItemSearchCriteria {StartDateFrom = DateTime.UtcNow.AddMonths(-1)} : null,
            savePreferences = false
        })
    }
}

